


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.12">
    
    
      
        <title>Test - Baker</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.4dd2dd8d.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../../css/ing.css">
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#test" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../../.." title="Baker" class="md-header-nav__button md-logo" aria-label="Baker">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Baker
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Test
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/ing-bank/baker/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ing-bank/baker
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Baker" class="md-nav__button md-logo" aria-label="Baker">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Baker
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/ing-bank/baker/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    ing-bank/baker
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../getting-started/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../concepts/" title="Concepts" class="md-nav__link">
      Concepts
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Development Life Cycle
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Development Life Cycle" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon"></span>
        Development Life Cycle
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../design-a-recipe/" title="Design a Recipe" class="md-nav__link">
      Design a Recipe
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../use-visualizations/" title="Use Visualizations" class="md-nav__link">
      Use Visualizations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../implement-interactions/" title="Implement Interactions" class="md-nav__link">
      Implement Interactions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../bake-fire-events-and-inquiry/" title="Bake, Fire Events and Inquiry" class="md-nav__link">
      Bake, Fire Events and Inquiry
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Test
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" title="Test" class="md-nav__link md-nav__link--active">
      Test
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#testing-recipes-for-soundness-compiling-the-recipe-in-a-test" class="md-nav__link">
    Testing Recipes for Soundness: Compiling the Recipe in a Test
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-recipes-for-correctness-mocking-interaction-implementations" class="md-nav__link">
    Testing Recipes for Correctness: Mocking Interaction Implementations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mocking-interaction-implementations-with-mockito" class="md-nav__link">
    Mocking Interaction Implementations with Mockito
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-individual-implementations" class="md-nav__link">
    Testing Individual Implementations
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../configure/" title="Configure" class="md-nav__link">
      Configure
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../monitor/" title="Monitor" class="md-nav__link">
      Monitor
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../resolve-failed-recipe-instances/" title="Resolve Failed Recipes" class="md-nav__link">
      Resolve Failed Recipes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Reference
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Reference" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon"></span>
        Reference
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/main-abstractions/" title="Main Abstractions" class="md-nav__link">
      Main Abstractions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/execution-semantics/" title="Execution Semantics" class="md-nav__link">
      Execution Semantics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/baker-types-and-values/" title="Baker Types and Values" class="md-nav__link">
      Baker Types and Values
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/dsls/" title="Recipe DSLs" class="md-nav__link">
      Recipe DSLs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/runtime/" title="The Akka Based Runtime" class="md-nav__link">
      The Akka Based Runtime
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/visualization/" title="Visualization" class="md-nav__link">
      Visualization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/event-listener/" title="Event Listener" class="md-nav__link">
      Event Listener
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/stores/" title="Event Stores and Cluster Configuration" class="md-nav__link">
      Event Stores and Cluster Configuration
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Versions
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Versions" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon"></span>
        Versions
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../versions/baker-3-release-notes/" title="Release Notes v3" class="md-nav__link">
      Release Notes v3
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../versions/baker-3/" title="Migration Guide v3" class="md-nav__link">
      Migration Guide v3
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../versions/baker-2/" title="Migration Guide v2" class="md-nav__link">
      Migration Guide v2
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../feature-comparison/" title="Feature comparison" class="md-nav__link">
      Feature comparison
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#testing-recipes-for-soundness-compiling-the-recipe-in-a-test" class="md-nav__link">
    Testing Recipes for Soundness: Compiling the Recipe in a Test
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-recipes-for-correctness-mocking-interaction-implementations" class="md-nav__link">
    Testing Recipes for Correctness: Mocking Interaction Implementations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mocking-interaction-implementations-with-mockito" class="md-nav__link">
    Mocking Interaction Implementations with Mockito
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-individual-implementations" class="md-nav__link">
    Testing Individual Implementations
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/ing-bank/baker/edit/master/docs/sections/development-life-cycle/test.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <h1 id="test">Test</h1>
<p>The Baker model already enforces separation and decoupling between parts of your system, which eases testability, it 
presents a model that divides units of code into modularized sections, more specifically, it provides a clear distinction
between business logic and implementation through the <code>Recipe</code> and <code>InteractionImplementations</code>, and independence between 
<code>Interactions</code>, since every <code>Interaction</code> should only depend on the input. </p>
<p>We present the layers of testing when using Baker, and how to write tests for such layers, use them as necessary.</p>
<h2 id="testing-recipes-for-soundness-compiling-the-recipe-in-a-test">Testing Recipes for Soundness: Compiling the Recipe in a Test</h2>
<p>First, one important notice is that currently Baker does not check at compile time the soundness of your Recipe (if your
Recipe makes any sense), but it does so when compiling it with the <code>RecipeCompiler.compileRecipe(recipe)</code> API. Errors are 
thrown in the form of exceptions describing the issue. So a simple unit test that simply compiles your <code>Recipe</code> is essential.</p>
<p>```scala tab="Scala"
class WebshopRecipeSpec extends FlatSpec with Matchers {</p>
<p>"The WebshopRecipe" should "compile the recipe without errors" in {
    RecipeCompiler.compileRecipe(WebshopRecipe.recipe)
  }
}
<div class="highlight"><pre><span></span><code>```scala tab=&quot;Java&quot;
public class JWebshopRecipeTests {

    @Test
    public void shouldCompileTheRecipeWithoutIssues() {
        RecipeCompiler.compileRecipe(JWebshopRecipe.recipe);
    }
}
</code></pre></div></p>
<h2 id="testing-recipes-for-correctness-mocking-interaction-implementations">Testing Recipes for Correctness: Mocking Interaction Implementations</h2>
<p>The next layer is to test that the Recipe actually does what you expect it to do at the business logic level <strong>independently</strong>
of the underlying implementations. One way of doing so is by providing <code>InteractionImplementations</code> that behave as expected
according to a testing scenario. </p>
<p>On the next example we will:</p>
<ol>
<li>Create a new local instance of baker.</li>
<li>Setup mocked interaction instances that behave according to your desired test scenario.</li>
<li>Wire the recipe and implementations to fire sensory events according to your desired test scenario.</li>
<li>Inspect the recipe instance state.</li>
<li>Assert expectations on the state and/or the sensory event results.</li>
</ol>
<p><em>Note: Take into consideration the asynchronous nature of Baker, some times the easiest is to use <code>fireAndResolveWhenCompleted</code>
that will resolve when a sensory event has completely finished affecting the state of the recipe instance.</em></p>
<p>```scala tab="Scala"</p>
<p>/*<em> Interface used to mock the ReserveItems interaction using the reflection API. </em>/
trait ReserveItems {</p>
<p>def apply(orderId: String, items: List[String]): Future[WebshopRecipeReflection.ReserveItemsOutput]
}</p>
<p>/*<em> Mock of the ReserveItems interaction. </em>/
class ReserveItemsMock extends ReserveItems {</p>
<p>override def apply(orderId: String, items: List[String]): Future[WebshopRecipeReflection.ReserveItemsOutput] =
    Future.successful(WebshopRecipeReflection.ItemsReserved(items))
}</p>
<p>"The Webshop Recipe" should "reserve items in happy conditions" in {</p>
<p>val system: ActorSystem = ActorSystem("baker-webshop-system")
  val baker: Baker =  AkkaBaker.localDefaul(system)</p>
<p>val compiled = RecipeCompiler.compileRecipe(WebshopRecipe.recipe)
  val recipeInstanceId: String = UUID.randomUUID().toString</p>
<p>val orderId: String = "order-id"
  val items: List[String] = List("item1", "item2")</p>
<p>val orderPlaced = EventInstance
    .unsafeFrom(WebshopRecipeReflection.OrderPlaced(orderId, items))
  val paymentMade = EventInstance
    .unsafeFrom(WebshopRecipeReflection.PaymentMade())</p>
<p>val reserveItemsInstance: InteractionInstance =
    InteractionInstance.unsafeFrom(new ReserveItemsMock)</p>
<p>for {
    _ &lt;- baker.addInteractionInstace(reserveItemsInstance)
    recipeId &lt;- baker.addRecipe(compiled)
    _ &lt;- baker.bake(recipeId, recipeInstanceId)
    _ &lt;- baker.fireEventAndResolveWhenCompleted(
      recipeInstanceId, orderPlaced)
    _ &lt;- baker.fireEventAndResolveWhenCompleted(
      recipeInstanceId, paymentMade)
    state &lt;- baker.getRecipeInstanceState(recipeInstanceId)
    provided = state
      .ingredients
      .find(<em>._1 == "reservedItems")
      .map(</em>.<em>2.as[List[String]])
      .map(</em>.mkString(", "))
      .getOrElse("No reserved items")
  } yield provided shouldBe items.mkString(", ")
}
<div class="highlight"><pre><span></span><code>```java tab=&quot;Java&quot;
static public class HappyFlowReserveItems implements JWebshopRecipe.ReserveItems {

    @Override
    public ReserveItemsOutcome apply(String id, List&lt;String&gt; items) {
        return new ItemsReserved(items);
    }
}

@Test
public void shouldRunSimpleInstance() {

    ActorSystem actorSystem = ActorSystem.create(&quot;WebshopSystem&quot;);
    Baker baker = AkkaBaker.javaLocalDefault(actorSystem);

    List&lt;String&gt; items = new ArrayList&lt;&gt;(2);
    items.add(&quot;item1&quot;);
    items.add(&quot;item2&quot;);

    EventInstance firstOrderPlaced =
            EventInstance.from(new JWebshopRecipe.OrderPlaced(&quot;order-uuid&quot;, items));
    EventInstance paymentMade =
            EventInstance.from(new JWebshopRecipe.PaymentMade());

    InteractionInstance reserveItemsInstance =
            InteractionInstance.from(new HappyFlowReserveItems());
    CompiledRecipe compiledRecipe =
            RecipeCompiler.compileRecipe(JWebshopRecipe.recipe);

    String recipeInstanceId = &quot;first-instance-id&quot;;
    CompletableFuture&lt;List&lt;String&gt;&gt; result = baker.addInteractionInstace(reserveItemsInstance)
            .thenCompose(ignore -&gt; baker.addRecipe(compiledRecipe))
            .thenCompose(recipeId -&gt; baker.bake(recipeId, recipeInstanceId))
            .thenCompose(ignore -&gt; baker.fireEventAndResolveWhenCompleted(recipeInstanceId, firstOrderPlaced))
            .thenCompose(ignore -&gt; baker.fireEventAndResolveWhenCompleted(recipeInstanceId, paymentMade))
            .thenCompose(ignore -&gt; baker.getRecipeInstanceState(recipeInstanceId))
            .thenApply(x -&gt; x.events().stream().map(EventMoment::getName).collect(Collectors.toList()));

    List&lt;String&gt; blockedResult = result.join();

    assert(blockedResult.contains(&quot;OrderPlaced&quot;) &amp;&amp; blockedResult.contains(&quot;PaymentMade&quot;) &amp;&amp; blockedResult.contains(&quot;ItemsReserved&quot;));
}
</code></pre></div></p>
<p>This test is replicating a full round through a <code>Recipe</code>, the only difference with your normal production code is that 
<code>InteractionInstances</code> are adapted to fit the scenario you want to check, so the objective here is to test that the <code>Recipe</code>
ends on the desired state given a certain order of firing sensory events and that the interaction instances return the
specific data.</p>
<p><em>Note: We recommend you abstract away these scenarios with a function that will run them given different 
interaction instances, so that you can run the same scenario on different environments, like when you want to do a E2E
on a test environment.</em></p>
<h2 id="mocking-interaction-implementations-with-mockito">Mocking Interaction Implementations with Mockito</h2>
<p>Baker supports <code>InteractionInstances</code> that are <a href="https://site.mockito.org/">mockito</a> mocks, this will give you the added 
semantics of Mockito, like verifying that the interaction instance was called, or even called with the expected data.</p>
<p>```scala tab="Scala" </p>
<p>trait ReserveItems {</p>
<p>def apply(orderId: String, items: List[String]): Future[WebshopRecipeReflection.ReserveItemsOutput]
}</p>
<p>"The Webshop Recipe" should "reserve items in happy conditions (mockito)" in {</p>
<p>val system: ActorSystem = ActorSystem("baker-webshop-system")
  val baker: Baker = AkkaBaker.localDefault(system)</p>
<p>val compiled = RecipeCompiler.compileRecipe(WebshopRecipe.recipe)
  val recipeInstanceId: String = UUID.randomUUID().toString</p>
<p>val orderId: String = "order-id"
  val items: List[String] = List("item1", "item2")</p>
<p>val orderPlaced = EventInstance
    .unsafeFrom(WebshopRecipeReflection.OrderPlaced(orderId, items))
  val paymentMade = EventInstance
    .unsafeFrom(WebshopRecipeReflection.PaymentMade())</p>
<p>// The ReserveItems interaction being mocked by Mockito
  val mockedReserveItems: ReserveItems = mock[ReserveItems]
  val reserveItemsInstance: InteractionInstance =
    InteractionInstance.unsafeFrom(mockedReserveItems)</p>
<p>when(mockedReserveItems.apply(orderId, items))
    .thenReturn(Future.successful(WebshopRecipeReflection.ItemsReserved(items)))</p>
<p>for {
    _ &lt;- baker.addInteractionInstace(reserveItemsInstance)
    recipeId &lt;- baker.addRecipe(compiled)
    _ &lt;- baker.bake(recipeId, recipeInstanceId)
    _ &lt;- baker.fireEventAndResolveWhenCompleted(
      recipeInstanceId, orderPlaced)
    _ &lt;- baker.fireEventAndResolveWhenCompleted(
      recipeInstanceId, paymentMade)
    state &lt;- baker.getRecipeInstanceState(recipeInstanceId)
    provided = state
      .ingredients
      .find(<em>._1 == "reservedItems")
      .map(</em>.<em>2.as[List[String]])
      .map(</em>.mkString(", "))
      .getOrElse("No reserved items")</p>
<div class="codehilite"><pre><span></span><code><span class="err">// Verify that the mock was called with the expected data</span>
<span class="err">_ = verify(mockedReserveItems).apply(orderId, items)</span>
</code></pre></div>


<p>} yield provided shouldBe items.mkString(", ")
}
<code></code>java tab="Java" 
import static org.mockito.Mockito.*;

@Test
public void shouldRunSimpleInstanceMockitoSample() {

    ActorSystem actorSystem = ActorSystem.create("WebshopSystem");
    Baker baker = AkkaBaker.javaLocalDefault(actorSystem);

    List<String> items = new ArrayList&lt;&gt;(2);
    items.add("item1");
    items.add("item2");

    EventInstance firstOrderPlaced =
            EventInstance.from(new JWebshopRecipe.OrderPlaced("order-uuid", items));
    EventInstance paymentMade =
            EventInstance.from(new JWebshopRecipe.PaymentMade());

    // The ReserveItems interaction being mocked by Mockito
    JWebshopRecipe.ReserveItems reserveItemsMock =
            mock(JWebshopRecipe.ReserveItems.class);
    InteractionInstance reserveItemsInstance =
            InteractionInstance.from(reserveItemsMock);
    CompiledRecipe compiledRecipe =
            RecipeCompiler.compileRecipe(JWebshopRecipe.recipe);

    // Add input expectations and their returned event instances
    when(reserveItemsMock.apply("order-uuid", items)).thenReturn(
            new JWebshopRecipe.ReserveItems.ItemsReserved(items));

    String recipeInstanceId = "first-instance-id";
    CompletableFuture<List\<String>> result = baker.addInteractionInstace(reserveItemsInstance)
            .thenCompose(ignore -&gt; baker.addRecipe(compiledRecipe))
            .thenCompose(recipeId -&gt; baker.bake(recipeId, recipeInstanceId))
            .thenCompose(ignore -&gt; baker.fireEventAndResolveWhenCompleted(recipeInstanceId, firstOrderPlaced))
            .thenCompose(ignore -&gt; baker.fireEventAndResolveWhenCompleted(recipeInstanceId, paymentMade))
            .thenCompose(ignore -&gt; baker.getRecipeInstanceState(recipeInstanceId))
            .thenApply(x -&gt; x.events().stream().map(EventMoment::getName).collect(Collectors.toList()));

    List<String> blockedResult = result.join();

    // Verify that the mock was called with the expected data
    verify(reserveItemsMock).apply("order-uuid", items);

    assert(blockedResult.contains("OrderPlaced") &amp;&amp; blockedResult.contains("PaymentMade") &amp;&amp; blockedResult.contains("ItemsReserved"));
}
```</p>
<h2 id="testing-individual-implementations">Testing Individual Implementations</h2>
<p>The final layer is to individually test your implementations, which will resemble your normal e2e tests, interconnectivity 
tests, or unit tests which mock the dependencies. If we put a code example here it would be more of a tutorial on how to 
generally test code than Baker, which is a good argument to show that Baker si all about decoupling your code and automatically
orchestrate it through distributed boundaries.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../bake-fire-events-and-inquiry/" title="Bake, Fire Events and Inquiry" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Bake, Fire Events and Inquiry
              </div>
            </div>
          </a>
        
        
          <a href="../configure/" title="Configure" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Configure
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/vendor.3636a4ec.min.js"></script>
      <script src="../../../assets/javascripts/bundle.e9fe3281.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../../..",
          features: [],
          search: Object.assign({
            worker: "../../../assets/javascripts/worker/search.5eca75d3.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>